<section  xmlns:th="http://www.thymeleaf.org" th:fragment="diagnosisModal">

<!--Add Diagnosis Modal-->
    <div id="diagnosisModal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <span class="close" id="closeDiagnosis">&times;</span>

            <div class="modal-header">
                <h3>Add Diagnosis</h3>

                <div>
                <button type="button" class="icon" onclick="viewPastRecords()" title="Past Records">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M17.44 3.5h-1.69v-.53a.95.95 0 0 0-1-.91h-5.5a.95.95 0 0 0-1 .91v.53H6.56A2.5 2.5 0 0 0 4.06 6v13.44a2.5 2.5 0 0 0 2.5 2.5h10.88a2.5 2.5 0 0 0 2.5-2.5V6a2.5 2.5 0 0 0-2.5-2.5m-8.19-.44l5.5.01v1.12c0 .61-.69 1.12-1.5 1.12h-2.5c-.82 0-1.5-.51-1.5-1.12Zm9.69 16.38a1.51 1.51 0 0 1-1.5 1.5H6.56a1.5 1.5 0 0 1-1.5-1.5V6a1.5 1.5 0 0 1 1.5-1.5h1.72a2.4 2.4 0 0 0 2.47 1.81h2.5a2.4 2.4 0 0 0 2.47-1.81h1.72a1.5 1.5 0 0 1 1.5 1.5Z"/><path fill="currentColor" d="M14.5 12.71a.5.5 0 0 1-.5.5h-1.5v1.5a.5.5 0 0 1-.5.5a.5.5 0 0 1-.5-.5v-1.5H10a.5.5 0 0 1-.5-.5a.5.5 0 0 1 .5-.5h1.5v-1.5a.5.5 0 0 1 .5-.5a.51.51 0 0 1 .5.5v1.5H14a.51.51 0 0 1 .5.5"/>
                    </svg>
                </button>
                <button type="button" class="icon" onclick="viewPastLabResults()"  title="Past Lab Results">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256">
                        <path fill="currentColor" stroke-width="6" stroke="currentColor" d="m234.83 89.18l-60-60a4 4 0 0 0-5.66 0L39.94 158.41a40.78 40.78 0 0 0 57.66 57.67L210.16 103.5l23.1-7.7a4 4 0 0 0 1.57-6.62M91.94 210.42a32.77 32.77 0 1 1-46.34-46.35L75 134.63c9.2-3.38 23.94-5.08 43.11 4.93c12.09 6.31 22.74 8.48 31.66 8.48c1.64 0 3.2-.09 4.73-.22Zm114.8-114.21a4.06 4.06 0 0 0-1.57 1L165 137.39c-9.2 3.38-23.94 5.08-43.11-4.93c-14.3-7.47-26.58-9.13-36.38-8.27L172 37.66l52.6 52.6Z"/>
                    </svg>
                </button>
                <button type="button" class="icon" onclick="viewPastPrescriptions()" title="Past Prescriptions">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path fill="currentColor" d="m17.373 21.189l1.496-1.516l-2.427-2.427l-1.515 1.496q-.523.524-.523 1.224t.523 1.223t1.223.523t1.223-.523m2.185-2.204l1.515-1.496q.523-.523.514-1.223t-.533-1.224q-.523-.503-1.213-.513t-1.214.513l-1.496 1.516zm-1.49 2.917q-.81.81-1.927.8q-1.118-.01-1.927-.8q-.791-.81-.8-1.927t.8-1.927l3.719-3.72q.79-.79 1.927-.79q1.136 0 1.927.79q.81.81.81 1.928t-.81 1.927zM5 19V5zm.616 1q-.672 0-1.144-.472T4 18.385V5.615q0-.67.472-1.143Q4.944 4 5.616 4h4.7q-.137-.766.366-1.383Q11.184 2 12 2q.835 0 1.338.617T13.685 4h4.7q.67 0 1.143.472q.472.472.472 1.144v5.182q-.25-.029-.5-.01t-.5.056V5.616q0-.27-.173-.443T18.385 5H5.615q-.269 0-.442.173T5 5.616v12.769q0 .269.173.442t.443.173h5.132q-.056.25-.075.5t.01.5zM12 4.442q.325 0 .538-.212t.212-.538t-.213-.537T12 2.942t-.537.213t-.213.537t.213.538t.537.212M7.5 8.731v-1h9v1zm0 3.769v-1h9v.408q-.142.106-.262.21t-.263.247l-.134.135zm0 3.77v-1h5.571l-.283.282q-.18.18-.353.359q-.172.177-.335.358z"
                              stroke-width="0.5" stroke="currentColor"/>
                    </svg>
                </button>
                </div>


            </div>
            <div id="diagnosis-message"></div>


            <form id="diagnosisForm"  >
                <input type="hidden" id="appointmentIdInput" name="appointmentID">
                <input type="hidden" id="userIdInput" name="userID">

                <label for="conditionName">Condition Name:</label>
                <input type="text" id="conditionName" name="conditionName" required>

                <!-- Treatment Plan -->
                <label for="treatmentPlan">Treatment Plan:</label>
                <textarea id="treatmentPlan" name="treatmentPlan" required></textarea>

                <!-- Follow-up Period (in months) -->
                <label for="followUpMonths">Follow-up (in months):</label>
                <input type="number" id="followUpMonths" name="followUpMonths" min="1" max="12" required>

                <!-- Action Buttons -->
                <div class="action-buttons">


                    <button type="button" id="doneButton" class="primary" >End Appointment</button>
                </div>
                <div class="form-row">
                    <button type="button" id="nextButton" class="secondary" >Add Prescription</button>
                    <button type="button" id="orderTest"  class="tertiary">Order Lab Tests
                    </button>
                </div>

            </form>
        </div>
    </div>
<!--View Medical History and Update the Status--->
    <div id="medicalHistoryModal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <span class="close" id=" closeMedicalHistory"  onclick="closeMedicalHistoryModal()">&times;</span>
            <h3>Medical History</h3>

            <!-- Medical Records Table -->
            <table class="Table">
                <thead>
                <tr>
                    <td>Condition</td>
                    <td>Diagnosed Date</td>
                    <td>Status</td>
                </tr>
                </thead>
                <tbody id="medicalRecordsBody">
                <!-- Data will be inserted here dynamically -->
                </tbody>
            </table>

            <button type="button" class="primary" id="updateMedical" onclick="updateMedicalHistory()">Save Changes</button>
        </div>
    </div>
    <!-- Past Prescriptions Modal -->
    <div id="viewPrescriptionsModal" class="modal" style="display:none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <span class="close" onclick="closePrescriptionHistory()">&times;</span>
            <h3>Past Prescriptions</h3>
            <table class="Table">
                <thead>
                <tr>
                    <td>Prescribed Date</td>
                    <td>Prescribed By</td>
                    <td>Medication Name</td>
                    <td>Dosage</td>
                    <td>Interval</td>
                    <td>Duration</td>
                </tr>
                </thead>
                <tbody id="prescriptionsBody"></tbody>
            </table>
        </div>
    </div>

    <!-- Past Lab Results Modal -->
    <div id="viewLabResultsModal" class="modal" style="display:none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <span class="close" onclick="closeLabResultsHistory()">&times;</span>
            <h3>Past Lab Results</h3>
            <table class="Table">
                <thead>
                <tr>
                    <td>Test Name</td>
                    <td>Result</td>
                    <td>Notes</td>
                    <td>Lab Technician</td>
                </tr>
                </thead>
                <tbody id="labResultsBody"></tbody>
            </table>
        </div>
    </div>

    <div class=" main " th:include="addPrecription::prescription">

    </div>

    <script  src="js/addDiagnosis.js"></script>
    <script  src="js/viewPrescriptionAndLabResults.js"></script>
    <script  src="js/orderLabTests.js"></script>

