<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/navBar.css">
    <link rel="stylesheet" href="css/patientHome.css">
</head>
<body>
<div class="container">
    <div class="row">

        <div class="myHeader p-2" xmlns:th="http://www.thymeleaf.org" th:fragment="header">
            <button class="back" onclick="goBack()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path fill="none" stroke="#currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 18l-6-6l6-6" />
                </svg>
            </button>
        <div class="pb-2 px-5">
            <div class=" w-auto text-center">
                <h2 id="page-title" >Default Title</h2>
            </div>
            </div>

            <div class="row d-flex align-items-center my-2">
                <div class="search-container">
                    <input class="px-2 search-bar" type="text" placeholder="Search...">
                </div>
            </div>
<script>
    function setPageTitleAndActiveNav() {
        const pageTitle = document.getElementById('page-title');
        const path = window.location.pathname;
        const navLinks = document.querySelectorAll('.navFix .nav-link');

        // Remove active class from all links
        navLinks.forEach(link => link.classList.remove('active'));

        // Set different titles and highlight active link based on the URL path
        if (path === '/userHome' || path === '/') { // Assuming '/' is also the home page
            pageTitle.textContent = 'HOME PAGE';
            navLinks[0].classList.add('active');
        } else if (path.includes('appointment')) {
            pageTitle.textContent = 'APPOINTMENTS';
            // You might not have a direct nav link for appointments in this structure
        } else if (path.includes('medical')) {
            pageTitle.textContent = 'MEDICAL RECORDS';
            // You might not have a direct nav link for medical records
        } else if (path.includes('prescription')) {
            pageTitle.textContent = 'PRESCRIPTION';
            // You might not have a direct nav link for prescription
        } else if (path.includes('lab')) {
            pageTitle.textContent = 'LAB REPORTS';
            // You might not have a direct nav link for lab reports
        } else if (path.includes('settings')) {
            pageTitle.textContent = 'SETTINGS';
            navLinks[2].classList.add('active');
        } else if (path.includes('notification')) {
            pageTitle.textContent = 'NOTIFICATION';
            navLinks[1].classList.add('active');
        } else {
            pageTitle.textContent = 'WELCOME'; // Fallback title
            // No nav link will be active
        }
    }

    // Ensure the function runs on page load
    document.addEventListener('DOMContentLoaded', setPageTitleAndActiveNav);

    // If you have client-side routing (SPA) or dynamic content loading, you can listen for URL changes:
    window.onpopstate = function() {
        setPageTitleAndActiveNav();
    };

    function goBack() {
        window.history.back();
    }
        </script>
        </div>

        <div class="row mainScreen">

            <div class="col-sm-12 mx-3 my-5 ">

                <div class="row px-4 mb-5">
                 <div class="col-sm-6">
                    <div><span>Gender:</span> Female &nbsp;&nbsp;
                        <span>Blood Type:</span> AB +</div>
                </div>
                    <div class="col-sm-6">
                    <div><span>Age:</span>  26 Years &nbsp;&nbsp; <span>Weight:</span> 65 Kg</div>
                </div>
                </div>


        <div class="row px-4">

                    <a href="/labView" class="col-5 col-md-2 m-2 p-4 card navCard">
                        <img src="image/LabReports.svg" alt="Diagnosis" style="height: 5vh; width: 5vh;" >
                        <div class="card-title">Lab Reports</div>
                    </a>


                    <a href="/prescription" class="col-5 col-md-2 m-2 p-4 card navCard">
                        <img src="image/Pill--Streamline-Ultimate.svg" alt="Diagnosis" style="height: 5vh; width: 5vh;" >
                        <div class="card-title">Prescription</div>
                    </a>


                    <a href="/appointment" class="col-5 col-md-2 m-2 p-4 card navCard">
                        <svg xmlns="http://www.w3.org/2000/svg" width="5vh" height="5vh" viewBox="0 0 24 24" >
                            <g fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1">
                                <path d="M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5M16 2v4M8 2v4m-5 4h5m9.5 7.5L16 16.3V14" />
                                <circle cx="16" cy="16" r="6" />
                            </g>
                        </svg>
                        <div class="card-title">Appointments</div>
                    </a>


                    <a href="/addPastmedical" class="col-5 col-md-2 m-2 p-4 card navCard" >
                        <img src="image/Medical History-Big.svg" alt="Medical History" style="height: 5vh; width: 5vh;">
                        <div class="card-title">Medical History</div>
                    </a>


    </div>
        </div>
            <div class="d-flex justify-content-evenly navFix" xmlns:th="http://www.thymeleaf.org" th:fragment="navBar" >

                <div >
                    <a href="/userHome" class="nav-link ">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <g fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1">
                                <path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8" />
                                <path d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                            </g>
                        </svg>
                    </a>
                </div>
                <div >
                    <a href="/notification" class="nav-link position-relative">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                                  d="M10.268 21a2 2 0 0 0 3.464 0m-10.47-5.674A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326" />
                        </svg>
                        <span id="unreadCount" class="unread-badge"></span>

                    </a>
                </div>
                <div >
                    <a href="/settings" class="nav-link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1">
                                <path
                                        d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2" />
                                <circle cx="12" cy="12" r="3" />
                            </g>
                        </svg>
                    </a>
                    <script>
                        function fetchUserNotifications() {
                            fetch('/api/notification/user')
                                .then(response => response.json())
                                .then(notifications => {
                                    displayNotifications(notifications);
                                })
                                .catch(error => console.error('Error fetching notifications:', error));
                        }

                        function updateUnreadCount() {
                            fetch('/api/notification/user/unread/count')
                                .then(response => response.json())
                                .then(count => {
                                    const unreadCountElement = document.getElementById('unreadCount');
                                    if (unreadCountElement) {
                                        unreadCountElement.textContent = count > 0 ? `${count}` : '';
                                    }
                                })
                                .catch(error => console.error('Error fetching unread count:', error));
                        }


                        document.addEventListener('DOMContentLoaded', function() {
                            fetchUserNotifications();
                            updateUnreadCount(); // Initial load of unread count

                            const markAllReadBtn = document.getElementById('markAllReadBtn');
                            if (markAllReadBtn) {
                                markAllReadBtn.addEventListener('click', markAllAsRead);
                                updateUnreadCount(); // Update after marking all as read
                            }
                        });
                    </script>
                </div>
            </div>

        </div>




</div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


</body>
</html>